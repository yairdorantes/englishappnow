{"ast":null,"code":"import _regeneratorRuntime from\"/home/yair/Escritorio/english/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/yair/Escritorio/english/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/yair/Escritorio/english/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import jwt_decode from\"jwt-decode\";import{createContext,useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import mySite from\"../components/Domain\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null;}),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setAuthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem(\"authTokens\")?jwt_decode(localStorage.getItem(\"authTokens\")):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];console.log(user);var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var navigate=useNavigate();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return fetch(\"\".concat(mySite,\"token/\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:e.target.username.value,password:e.target.password.value})});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;if(response.status===200){console.log(\"success\");setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));navigate(\"/\");}else{alert(\"Ups, algo salió mal intentalo de nuevo\");}case 8:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();// let loginAfterSignUp =()=>{\n// }\nvar logoutUser=function logoutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem(\"authTokens\");navigate(\"/login\");};// let updateToken = async () => {\n//   console.log(\"update token called\");\n//   let response = await fetch(`${mySite}token/refresh/`, {\n//     method: \"POST\",\n//     headers: {\n//       \"Content-Type\": \"application/json\",\n//     },\n//     body: JSON.stringify({\n//       refresh: authTokens?.refresh,\n//     }),\n//   });\n//   let data = await response.json();\n//   if (response.satus === 200) {\n//     setAuthTokens(data);\n//     setUser(jwt_decode(data.access));\n//     localStorage.setItem(\"authTokens\", JSON.stringify(data));\n//   } else {\n//     console.log(\"err\");\n//     //logoutUser();\n//   }\n//   if (loading) {\n//     setLoading(false);\n//   }\n// };\nvar contextData={user:user,authTokens:authTokens,loginUser:loginUser,logoutUser:logoutUser};// useEffect(() => {\n//   if (loading) {\n//     updateToken();\n//   }\n//   let fourMinutes = 1000 * 60 * 4;\n//   let interval = setInterval(() => {\n//     if (authTokens) {\n//       updateToken();\n//     }\n//   }, fourMinutes);\n//   return () => clearInterval(interval);\n// }, [authTokens, loading]);\nreturn/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:children});};","map":{"version":3,"names":["jwt_decode","createContext","useEffect","useState","useNavigate","mySite","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","authTokens","setAuthTokens","user","setUser","console","log","loading","setLoading","navigate","loginUser","e","preventDefault","fetch","method","headers","body","stringify","username","target","value","password","response","json","data","status","access","setItem","alert","logoutUser","removeItem","contextData"],"sources":["/home/yair/Escritorio/english/src/context/AuthContext.js"],"sourcesContent":["import jwt_decode from \"jwt-decode\";\nimport { createContext, useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport mySite from \"../components/Domain\";\nconst AuthContext = createContext();\n\nexport default AuthContext;\n\nexport const AuthProvider = ({ children }) => {\n  let [authTokens, setAuthTokens] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n  let [user, setUser] = useState(() =>\n    localStorage.getItem(\"authTokens\")\n      ? jwt_decode(localStorage.getItem(\"authTokens\"))\n      : null\n  );\n  console.log(user);\n  const [loading, setLoading] = useState(true);\n\n  const navigate = useNavigate();\n\n  let loginUser = async (e) => {\n    e.preventDefault();\n    let response = await fetch(`${mySite}token/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        username: e.target.username.value,\n        password: e.target.password.value,\n      }),\n    });\n    let data = await response.json();\n    if (response.status === 200) {\n      console.log(\"success\");\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      navigate(\"/\");\n    } else {\n      alert(\"Ups, algo salió mal intentalo de nuevo\");\n    }\n  };\n  // let loginAfterSignUp =()=>{\n\n  // }\n\n  let logoutUser = () => {\n    setAuthTokens(null);\n    setUser(null);\n    localStorage.removeItem(\"authTokens\");\n    navigate(\"/login\");\n  };\n\n  // let updateToken = async () => {\n  //   console.log(\"update token called\");\n  //   let response = await fetch(`${mySite}token/refresh/`, {\n  //     method: \"POST\",\n  //     headers: {\n  //       \"Content-Type\": \"application/json\",\n  //     },\n  //     body: JSON.stringify({\n  //       refresh: authTokens?.refresh,\n  //     }),\n  //   });\n  //   let data = await response.json();\n\n  //   if (response.satus === 200) {\n  //     setAuthTokens(data);\n  //     setUser(jwt_decode(data.access));\n  //     localStorage.setItem(\"authTokens\", JSON.stringify(data));\n  //   } else {\n  //     console.log(\"err\");\n  //     //logoutUser();\n  //   }\n  //   if (loading) {\n  //     setLoading(false);\n  //   }\n  // };\n\n  let contextData = {\n    user: user,\n    authTokens: authTokens,\n    loginUser: loginUser,\n    logoutUser: logoutUser,\n  };\n\n  // useEffect(() => {\n  //   if (loading) {\n  //     updateToken();\n  //   }\n  //   let fourMinutes = 1000 * 60 * 4;\n  //   let interval = setInterval(() => {\n  //     if (authTokens) {\n  //       updateToken();\n  //     }\n  //   }, fourMinutes);\n  //   return () => clearInterval(interval);\n  // }, [authTokens, loading]);\n\n  return (\n    <AuthContext.Provider value={contextData}>{children}</AuthContext.Provider>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}